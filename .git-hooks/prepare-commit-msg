#!/bin/bash
# Hook prepare-commit-msg pour neuronspikes
# Ajoute automatiquement une entrÃ©e de journal au message de commit

COMMIT_MSG_FILE=$1
COMMIT_SOURCE=$2
SHA1=$3

# Ne pas modifier si c'est un merge, squash ou amend
if [ "$COMMIT_SOURCE" = "merge" ] || [ "$COMMIT_SOURCE" = "squash" ]; then
    exit 0
fi

# Obtenir la date/heure actuelle
TIMESTAMP=$(date '+%Y-%m-%d %H:%M:%S')

# Obtenir les fichiers modifiÃ©s
STAGED_FILES=$(git diff --cached --name-only | head -10)
FILE_COUNT=$(git diff --cached --name-only | wc -l)

# Obtenir les stats
INSERTIONS=$(git diff --cached --stat | tail -1 | grep -oP '\d+ insertion' | grep -oP '\d+' || echo "0")
DELETIONS=$(git diff --cached --stat | tail -1 | grep -oP '\d+ deletion' | grep -oP '\d+' || echo "0")

# CrÃ©er le footer dÃ©taillÃ©
{
    echo ""
    echo "---"
    echo "ðŸ“… Timestamp: $TIMESTAMP"
    echo "ðŸ“Š Stats: +$INSERTIONS/-$DELETIONS lignes"
    echo "ðŸ“ Fichiers ($FILE_COUNT):"
    echo "$STAGED_FILES" | sed 's/^/  - /'
    if [ "$FILE_COUNT" -gt 10 ]; then
        echo "  ... et $((FILE_COUNT - 10)) autres"
    fi
} >> "$COMMIT_MSG_FILE"
